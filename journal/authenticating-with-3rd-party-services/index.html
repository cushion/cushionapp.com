



<!DOCTYPE html>
<html>
  <head>
  <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>

  <title>Cushion - Authenticating with 3rd Party Services</title>

  <meta name='description' content='Simple project scheduling, budgeting, and invoice tracking'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

  

  <link rel='icon' type='image/png' href='/assets/images/favicon.png'>
  <link rel='shortcut icon' type='image/png' href='/assets/images/favicon.png'>

  <script>
  (function() {
  var config = {
  kitId: 'jpp2iwq',
  async: true,
  scriptTimeout: 3000
  };
  var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
  })();
</script>

<link href='//cdn.symbolset.com/e371e33079d457f2b85f25516d31c92a439778b8/symbolset.css' rel='stylesheet'>


  <link href='/assets/styles/screen.css' rel='stylesheet'>
  <link rel='alternate' type='application/rss+xml' title='RSS' href='/journal/feed.xml'>

  <script src='https://code.jquery.com/jquery-2.1.3.min.js'></script>

  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
  analytics.load("lvwwqqgyp6");
  analytics.page()
  }}();
</script>


  
</head>


  <body class='page'>
    <header class='grid-container--wide page__header'>
  <h1 class='page__logo'>
    <a href='/'>Cushion</a>
  </h1>

  <nav class='page-nav'>
  <ul class='page-nav__list'>
    
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/journal'>Journal</a>
        </li>
        
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/expenses'>Expenses</a>
        </li>
        
      
    
      
        
      
    
      
        
      
    
    <li class='no-mobile page-nav__item'>
      <a class='page-nav__link' href='https://beta.cushionapp.com/login'>Sign In</a>
    </li>
    <li class='page-nav__item'>
      <a class='ss-icon page-nav__icon' href='https://twitter.com/cushionapp'>twitter</a>
    </li>
  </ul>
</nav>

</header>


    
<main class='grid-container--narrow'>
  <article class='post'>
    <header class='post__header'>
      <h3 class='post__title'>
        <a href='/journal/authenticating-with-3rd-party-services'>Authenticating with 3rd Party Services</a>
      </h3>
      <time class='post__date' datetime='2015-06-15 21:26:00 -0400'>Jun 15, 2015</time>
    </header>

    <div class='post__body'>
      <p>I’ll be honest—authentication is not an exciting topic. I thought about skipping this post, but then I realized that this subject is often left out of blog posts. Either the post is about everything after authentication or the author realizes that authentication is an entire post on its own, so they write a quick paragraph and link to another article. After all I’ve been through with integrations, it would be a disservice to myself and others to skip this post—I’ve learned too much, and I need to share this knowledge!</p>

<hr>

<p>The first thing to know about authenticating with a 3rd party service is that there are multiple methods for doing so, and it’s up to the service to decide which method you must use. Newer services will often start by providing a simpler method of authentication, like BasicAuth with an API key, while more veteran services will offer more user-friendly authorization flows, like OAuth. Both serve the purpose of authenticating with the service, but one is easier on the dev while the other is easier on the user. </p>

<p><img src="/assets/authorizing-integrations-oauth.png" alt="authorizing-integrations-oauth"> </p>

<p>If a service looks appealing enough to integrate with, there’s a good chance it’s using one of the more serious methods of authentication. I say this because integrations are a real commitment, and if the service really wants you to tie your app so closely to theirs, they’ve probably gone the extra mile to support one of the open standards of authentication. </p>

<p>In my own experience, BasicAuth often means “Yes, we have an API. You can play with it if you want,” while OAuth2 means “Our business relies on integrations as a selling point. Here’s our documentation, support center, and IRC channel.” Occasionally, you’ll find a neglected service with forced support for OAuth or a solid service that doesn’t need anything more than BasicAuth, but the authentication method is often a good indicator of how smooth this ride will be.</p>

<p><img src="/assets/authorizing-integrations-documentation.png" alt="authorizing-integrations-documentation"> </p>

<p>With Cushion, I started out by integrating with the heavy hitters of the freelance industry—<a href="https://getharvest.com">Harvest</a> and <a href="https://freshbooks.com">FreshBooks</a>. Both support OAuth, which is great, but each supports a different version of the standard, which is not great. Harvest offers authentication through OAuth2, which directs the user through an authorization flow and provides the dev with an access token and a refresh token. The access token expires after 18 hours, so the dev will eventually need to request a new access token using the refresh token. This is a bit of extra work, but it keeps the token somewhat fresh, in case the access token lands in the wrong hands. </p>

<p>FreshBooks, the older of the two services, offers authentication through OAuth1, the older standard. To the user, the authorization flow is the same, but to the dev, there’s no expiration on the access token. Once the dev receives the token, they’re good to go indefinitely, until the user deauthorizes the integration. OAuth1 is definitely easier on the dev, but not as secure. Then again, an 18-hour expiration period sort of defeats the purpose of an expiring token.</p>

<p><img src="/assets/authorizing-integrations-custom.png" alt="authorizing-integrations-custom"> </p>

<p>At first, I built an authorization system from scratch using the <a href="https://github.com/oauth-xx/oauth-ruby">OAuth</a> and <a href="https://github.com/intridea/oauth2">OAuth2</a> gems. After authorizing, Cushion would show a sleek progress screen as it moved through each step before retrieving the tokens. For anyone using Cushion, it looked seamless, but under the hood, it was a mess. I could easily imagine this system becoming a headache with each new service I added—especially if it introduced a new authorization method. After wrapping up Harvest, it finally dawned on me that another solution existed—a <em>much</em> easier one. I still kick myself for forgetting the <a href="https://github.com/intridea/omniauth">OmniAuth</a> gem, but in a single afternoon, I was able to replicate the same system I spent weeks implementing. I can’t get those weeks back, but at least I caught myself before I wasted even more time.</p>

<p>For those unfamiliar with OmniAuth, it abstracts the authorization process through the use of “<a href="https://github.com/intridea/omniauth/wiki/List-of-Strategies">strategies</a>”. The strategy tells OmniAuth which authentication method the service uses and then formats the service’s response into standardized payloads. The user payload includes the user’s ID, name, email, etc., while the credentials include the access token and optional refresh token. With OmniAuth, authorizing with a new service is as easy as installing its strategy. Though OmniAuth is more commonly used during the sign up process, it works surprisingly well with integrations, too.</p>

<p>Now that I had OmniAuth handling the authorization flow, I needed to safely store the access tokens. Access tokens don’t seem as precious as passwords, but considering they grant access to users’ account, they should be protected just the same. I store access tokens in an encrypted column on the authorization model, which bridges the gap between the user and the 3rd party service. To enable an integration, I simply need to pass it the authorization model—nothing more.</p>

<p><img src="/assets/authorizing-integrations-authorizations.png" alt="authorizing-integrations-authorizations"> </p>

<p>Currently, Cushion only allows one authorization per service, but I quickly learned that many users have multiple accounts for a single service. Since services like Harvest are used by both freelancers and companies, clients will often invite freelancers to be a guest on their account to streamline the delivery of hours and invoices. Some freelancers also invite their subcontractors to use their account for the same reason. </p>

<p><img src="/assets/authorizing-integrations-multiple-authorizations.png" alt="authorizing-integrations-multiple-authorizations"> </p>

<p>Luckily, the changes required to make multiple authorizations happen are minimal. I built the integration system in a way that allows for multiple authorizations from the start—I just need to design the front-end to handle them. This will entail asking the user which account to use whenever enabling an integration and providing the ability to delete authorizations from the table view. If I end up including any additional details with authorizations, like activity, I might be able to justify a new page for an individual authorization. At the moment, though, the table view will suffice.</p>

    </div>

    <div class='post__alert'>
      <div class='alert'>
        <p>For more updates, follow @<a href="https://twitter.com/cushionapp">cushionapp</a> and sign up for the newsletter.</p>

      </div>
    </div>

    <div class='newsletter'>
  <div class='is-hidden js-newsletter-alert alert'></div>

  <form class='js-newsletter-form' action="//cushionapp.us9.list-manage.com/subscribe/post-json?u=313d794b00e529c8199ff32e2&amp;id=9f4ec10ac5" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_313d794b00e529c8199ff32e2_9f4ec10ac5" tabindex="-1" value=""></div>
    <input name='EMAIL' class='js-newsletter-input newsletter__input input--text input' type='email' placeholder='you@yourwebsite.com'><button class='js-newsletter-button newsletter__button button' type='submit'>Sign up</button>
  </form>
</div>

  </article>

  <section id='archive'>
    <h3 class='page__title'>Archive</h3>

    <ul class='post-list'>
      
      <li class='post-list__item'>
        <a class='link--strike link--hover-border' href='/journal/authenticating-with-3rd-party-services'>Authenticating with 3rd Party Services</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/intro-to-integrations'>Intro to Integrations</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/inspiration-vs-imitation'>Inspiration vs Imitation</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/the-emotional-rollercoaster'>The Emotional Rollercoaster</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/designing-project-blocks'>Designing Project Blocks</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/everything-in-increments'>Everything in Increments</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/deleting-your-account'>Deleting Your Account</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/designing-the-subscription-page'>Designing the Subscription Page</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/rewriting-the-timeline'>Rewriting the Timeline</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/restructuring-the-individual-project-page'>Restructuring the Individual Project Page</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/project-blocks'>Project Blocks</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/redesigning-the-homepage'>Redesigning the Homepage</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/multiple-timelines'>Multiple Timelines</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/archiving-and-estimate-differences'>Archiving and Estimate Differences</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/multiple-financial-goals'>Multiple Financial Goals</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/zooming-in-on-the-timeline'>Zooming in on the Timeline</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/currency'>Currency</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/preferences-accounts-and-atypefacechange'>Preferences, Accounts, and a Typeface Change</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/sending-out-the-first-email'>Sending Out the First Email</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/currency-inputs-notifications-and-invoice-nets'>Currency Inputs, Notifications, and Invoice Nets</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/dots-and-lines'>Dots and Lines</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/calculating-in-the-database-and-revealing-tendencies'>Calculating in the Database and Revealing Tendencies</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/improved-form-ux'>Improved Form UX</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/cushion-is-online'>Cushion is Online</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/schedule-timeline-patterns'>Schedule Timeline Patterns</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/a-slimmer-schedule-timeline'>A Slimmer Schedule Timeline</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/the-schedule-timeline'>The Schedule Timeline</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/plugging-in-real-data-for-the-first-time'>Plugging in Real Data for the First Time</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/transitions-and-project-lists'>Transitions and Project Lists</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/death-to-modals'>Death to Modals</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/the-individual-project-page'>The Individual Project Page</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/estimated-incomes-and-talks-with-other-freelancers'>Estimated Incomes and Talks with Other Freelancers</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/statuses-to-lists-and-the-paid-beta'>Statuses to Lists and the Paid Beta</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/the-timeline'>The Timeline</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/invoice-terminology'>Invoice Terminology</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/modal-forms'>Modal Forms</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/wiring-the-backend-to-the-frontend'>Wiring the Backend to the Frontend</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/balancing-design-and-dev'>Balancing Design and Dev</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/timecop-monocle-and-vagrant'>Timecop, Monocle, and Vagrant</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/going-with-ruby-and-sinatra'>Going with Ruby and Sinatra</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/ditching-local-first-and-trying-out-nodejs'>Ditching local-first and trying out Node.js</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/switching-to-angularjs'>Switching to AngularJS</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/building-the-table-with-vuejs'>Building the Table with Vue.js</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/clients-projects-and-invoices'>Clients, Projects, and Invoices</a>
      </li>
      
      <li class='post-list__item'>
        <a class=' link--hover-border' href='/journal/introduction'>Introduction</a>
      </li>
      
    </ul>
  </section>
</main>
<script src='/assets/scripts/newsletter.js'></script>


    <footer class='grid-container--wide page__footer'>
      
      <nav class='page-nav'>
  <ul class='page-nav__list'>
    
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/journal'>Journal</a>
        </li>
        
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/expenses'>Expenses</a>
        </li>
        
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/privacy'>Privacy Policy</a>
        </li>
        
      
    
      
        
        <li class='page-nav__item'>
          <a class='page-nav__link' href='/terms'>Terms &amp; Conditions</a>
        </li>
        
      
    
    <li class='no-mobile page-nav__item'>
      <a class='page-nav__link' href='https://beta.cushionapp.com/login'>Sign In</a>
    </li>
    <li class='page-nav__item'>
      <a class='ss-icon page-nav__icon' href='https://twitter.com/cushionapp'>twitter</a>
    </li>
  </ul>
</nav>

    </footer>

    
  </body>
</html>


